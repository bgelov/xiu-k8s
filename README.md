# Задача 2
Реализация кластера для разверстки ее в production среде kubernetes.

Успешным результатом является:
- Возможность масштабирования кластера и load-balancing rtmp.
- Написан ingress-конфиг для httpflv и hls ендпоинтов на поддомены.

Срок выполнения 3 дня.

Решение предоставить в виде архива petrov-stage2-1685933169-1685933170.tar.xz, где timestamp - время получения и сдачи задания. И предоставить writeup сописанием решения WRITEUP.md в архиве.

## Требования к реализации
- Продемонстрировать работоспособность масштабирования.
- Сдеплоить в 1 экземпляре и с помощью scale увеличить значение до 3 и уменьшить до 2.
- Продемонстрировать работу балансировки нагрузки на rtmp-кластер.

Также, будет плюсом:
- HPA
- SSL для HLS и HTTPFLV
- liveness/readiness

---

# Ход мыслей
Если мы будем использовать в такой конфигурации, то как я понимаю процесс, подать трансляцию сможет любой желающий. Следовательно, нам надо разграничить возможность просмотра трансляции и возможности трансляции.



# Решение

Начнём с написания минимального деплоя и тестирования на локальном minikube. Далее будем дополнять необходимыми компонентами и в итоге развернём сервис на AWS EKS.

Поднимаем тестовый кластер minikube
```
minikube start --profile k8s-cluster-1
```

Создаём неймспейс xiu-prod-namespace
```
apiVersion: v1
kind: Namespace
metadata:
  name: xiu-prod-namespace
  labels:
    app: xiu
    environment: prod
```

В xiu у нас используются конфигурации, поэтому можем сразу написать конфигмап
```

```




kubectl apply -f <имя_файла>.yaml


# HPA (Horizontal Pod Autoscaler)
Настроим автоматическое масштабирование подов на основе метрик, таких как загрузка CPU или количество соединений.

# SSL для HLS и HTTPFLV
Воспользуемся сервисом Let's Encrypt.
Установим Cert-Manager
https://cert-manager.io/docs/installation/

# Liveness/Readiness Probes
Создадим проверку жизнеспособности и готовности подов, чтобы k8s мог мониторить их состояние и выполнял какие-либо действия при проблемах.
